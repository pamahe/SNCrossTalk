========================
The ``crd2root`` program
========================



.. contents::

--------

Dependencies
============

The ``crd2root`` program depends on :

* A modern C++ compiler implementing the c++11 standard
* CMake (>= 3.3)
* The ``SNFEE`` library
* The ``Bayeux_`` library (version > 3.3)

Installation
============

The ``crd2root`` need to be compiled with ``SNFEE`` and ``Bayeux_`` libraries:

.. code:: bash

	  $ cd crd2root
	  $ mkdir _build.d
	  $ cd _build.d
	  $ cmake -DCMAKE_INSTALL_PREFIX=$(pwd)/../_install.d ..
	  $ cd ..

Calorimeter hit example in a CRD file
=====================================

	  
Usage
=====

The ``crd2root`` program is launch (when working on the CCIN2P3) with :

.. code:: bash

	  $ ./_install.d/crd2root \
	  --input-lis /sps/nemo/snemo/snemo_data/raw_data/RHD/run_100/snemo_ \
	  --output-file output.root \

The following options are allowed :

+--------------------+-----------------------------------------------------------------------------------------+
| --high-threshold   | process only hits which have crossed the high threshold (HT = 1)                        |
+--------------------+-----------------------------------------------------------------------------------------+
| --low-threshold    | process only hits which have crossed the low threshold  (LT = 1)                        |
+--------------------+-----------------------------------------------------------------------------------------+
| --process-full     | if this option is not present, the output tree will be limited to the first 11 branches |
+--------------------+-----------------------------------------------------------------------------------------+
| --max-crd          | set the maximum number of crd records to be parsed                                      |
+--------------------+-----------------------------------------------------------------------------------------+

The ``crd2root`` use the specific structures of ``CRD`` files to parse values into the differente branches of a ROOT tree (``Calo_Hits``):

+-------------------------+-------------------------+------------------------------------------------------------------------------------------+
|      Branch name        |     type                |                                      description                                         |
+-------------------------+-------------------------+------------------------------------------------------------------------------------------+
| hit_number              | Int_t                   | Hit registration order, number of the crd record in a run                                |
+-------------------------+-------------------------+------------------------------------------------------------------------------------------+
| trigger_id              | Int_t                   |                                                                                          |
+-------------------------+-------------------------+------------------------------------------------------------------------------------------+
| slot_id                 | UInt_t                  | Board number of the registered hit (column, 0 to 19)                                     |
+-------------------------+-------------------------+------------------------------------------------------------------------------------------+
| channel_id              | UInt_t                  | Channel number of the registered hit (row, 0 to 12)                                      |
+-------------------------+-------------------------+------------------------------------------------------------------------------------------+
| LT_flag                 | UShort_t (bool 0 or 1)  | 1 if the lower threshold is crossed, 0 otherwise (TO BE CHECKED)                         |
+-------------------------+-------------------------+------------------------------------------------------------------------------------------+
| HT_flag                 | UShort_t (bool 0 or 1)  | 1 if the higher threshold is crossed, 0 otherwise                                        |
+-------------------------+-------------------------+------------------------------------------------------------------------------------------+
| event_id                | UInt_t                  | Event ID from which the CRD record come from                                             |
+-------------------------+-------------------------+------------------------------------------------------------------------------------------+

+-------------------------+-------------------------+------------------------------------------------------------------------------------------+
| raw_tdc                 | ULong64_t               | Arrival time of the hit in timestamps                                                    |
+-------------------------+-------------------------+------------------------------------------------------------------------------------------+
| tdc_ns                  | Double_t                | Arrival time of the hit in nanoseconds (1 timestamp = 6.25 ns)                           |
+-------------------------+-------------------------+------------------------------------------------------------------------------------------+
| lt_trig_count           | UInt_t                  | Iterator storing the number of events with HT = 1 not registered between two events      |
+-------------------------+-------------------------+------------------------------------------------------------------------------------------+
| lt_time_count           | UInt_t                  |                                                                                          |
+-------------------------+-------------------------+------------------------------------------------------------------------------------------+

+-------------------------+-------------------------+------------------------------------------------------------------------------------------+
| raw_baseline            | Int_t                   |                                                                                          |
+-------------------------+-------------------------+------------------------------------------------------------------------------------------+
| baseline_volt           | Double_t                |                                                                                          |
+-------------------------+-------------------------+------------------------------------------------------------------------------------------+

+-------------------------+-------------------------+------------------------------------------------------------------------------------------+
| raw_peak                | Short_t                 |                                                                                          |
+-------------------------+-------------------------+------------------------------------------------------------------------------------------+
| peak_cell               | UShort_t                |                                                                                          |
+-------------------------+-------------------------+------------------------------------------------------------------------------------------+
| peak_volt               | Double_t                |                                                                                          |
+-------------------------+-------------------------+------------------------------------------------------------------------------------------+

+-------------------------+-------------------------+------------------------------------------------------------------------------------------+
| raw_charge              | Int_t                   |                                                                                          |
+-------------------------+-------------------------+------------------------------------------------------------------------------------------+
| charge_picocoulomb      | Double_t                |                                                                                          |
+-------------------------+-------------------------+------------------------------------------------------------------------------------------+
| charge_overflow         | Short_t (bool 0 or 1)   | Take value 1 if raw_charge is too large to be contained in a int32_t                     |
+-------------------------+-------------------------+------------------------------------------------------------------------------------------+

+-------------------------+-------------------------+------------------------------------------------------------------------------------------+
| rising_cell             | UInt_t                  | Threshold crossing (rising slope, sample number)                                         |
+-------------------------+-------------------------+------------------------------------------------------------------------------------------+
| rising_offset           | UInt_t                  | Linear interpolation (rising slope)                                                      |
+-------------------------+-------------------------+------------------------------------------------------------------------------------------+
| rising_ns               | Double_t                | Rising time (in ns), from 10% to 90% (TO BE CHECKED)                                     |
+-------------------------+-------------------------+------------------------------------------------------------------------------------------+
| falling_cell            | UInt_t                  | Threshold crossing (falling slope, sample number)                                        |
+-------------------------+-------------------------+------------------------------------------------------------------------------------------+
| falling_offset          | UInt_t                  | Linear interpolation (falling slope)                                                     |
+-------------------------+-------------------------+------------------------------------------------------------------------------------------+
| falling_ns              | Double_t                | Falling time (in ns), from 90% to 10% (TO BE CHECKED)                                    |
+-------------------------+-------------------------+------------------------------------------------------------------------------------------+

+-------------------------+-------------------------+------------------------------------------------------------------------------------------+
| fcr                     | UShort_t                |                                                                                          |
+-------------------------+-------------------------+------------------------------------------------------------------------------------------+
| unix_time               | Double_t                |                                                                                          |
+-------------------------+-------------------------+------------------------------------------------------------------------------------------+
| waveform_samples        | Int_t (array [1024] )   | A waveform is registered on 400 ns in 1024 samples (390,625 ps / sample)                 |
+-------------------------+-------------------------+------------------------------------------------------------------------------------------+

